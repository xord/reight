# 2024年度 Ruby アソシエーション開発助成金 最終報告

## 1. はじめに

この資料は、「2024 年度 Ruby アソシエーション開発助成金」制度で採択された「Processing Gem ベースの 2D レトロゲームエンジンの開発」についての最終報告書になります。

## 2. プロジェクト概要

昨年度採択された[CRuby 用 Processing Gem の本家 Processing との互換性向上に向けた取り組み](https://www.ruby.or.jp/ja/news/20240607)を基に、その成果物である Processing Gem をベースにして新たに 2Dレトロゲームエンジンの開発を行いました。

このゲームエンジンは 2D のレトロゲームをターゲットとし、解像度や色数、オーディオ関連の仕様に意図的な制限を設けることでゲーム開発の複雑さを軽減し、初心者でも手軽にゲーム制作を始められる環境を提供することを目的としています。

Ruby と Processing を基盤とするこのゲームエンジンの開発により Ruby を活用したゲーム制作の幅を広げ、コミュニティの発展に貢献することを目指すものです。

## 3. 開発内容

本プロジェクトではレトロゲームエンジンを開発するにあたり、以下の順で開発を進めました。

- スプライトエディター
- マップエディター
- 統合環境化
- ゲーム実行機能
- オーディオ機能実装に足りてない機能を低レイヤーに実装
- サウンドエディター

ここからはそれぞれの開発内容について詳しく説明していきます。

### 3.1 スプライトエディター

本ゲームエンジンは 2Dレトロゲームを主なターゲットとしておりドット絵を基本としたゲーム制作を想定しています。そのため、まずはドット絵制作に特化したエディターを開発しました。

#### 3.1.1 機能説明

ここでは、スプライトエディターの画面を機能ごとに説明します。

![image](https://gist.github.com/user-attachments/assets/db23b977-b25a-4896-8d0d-99fcb7e65093)

1. ![image](https://gist.github.com/user-attachments/assets/1be09135-0e0a-48ba-aa0e-5f830cfb66a7) スプライトページ選択<br>
   3 の「スプライト選択領域」を16ページ分保持していますので、数字横の左右ボタンで表示するページを切り替えることができます。
2. ![image](https://gist.github.com/user-attachments/assets/70784aba-4bd5-47d2-a298-0f5440e3139a) スプライトのサイズ選択<br>
   8、16、32 はそれぞれドットで 8x8、16x16、32x32 を表し、ドット絵編集領域を選択したサイズに変更します。またスプライト選択領域の選択枠も、選択したサイズに合わせた大きさに変わります。
3. スプライト選択領域<br>
   8x8 や 16x16 の大きさのスプライト画像を敷き詰めたスプライトシートを表示します。<br>
   各スプライト画像をクリックして選択するとドット絵編集領域に表示し、描画ツールで編集できるるようにします。
4. ドット絵編集領域<br>
   スプライト選択領域で選択した範囲のスプライト画像を、5 の描画ツールを使って編集します。
5. 描画ツール
   1. ![image](https://gist.github.com/user-attachments/assets/ea8331ed-b785-4d7d-8e51-af0bfeb2458f) 選択ツール<br>
      ドット絵の一部を選択し、カット・コピーしたり移動したりできます
   2. ![image](https://gist.github.com/user-attachments/assets/b05f1179-37c8-4591-ab15-e16c85a3e207) ブラシ<br>
      クリックした位置に、選択した色でドットを描画します
   3. ![image](https://gist.github.com/user-attachments/assets/e6594831-3611-4a33-adb3-cdd4e51a23dd) 塗りつぶし<br>
      クリックした位置の周囲を、選択した色で塗りつぶします
   4. ![image](https://gist.github.com/user-attachments/assets/6bce9477-7d9c-440f-b2d3-a90974d4d387) 直線ツール<br>
      ドラッグした始点と終点を、選択した色で直線を描画します
   5. ![image](https://gist.github.com/user-attachments/assets/8ca9796b-ca0f-46d8-9e0e-e5db153c186d) 矩形（枠線）<br>
      ドラッグした始点と終点を矩形の左上と右下とし、選択した色で枠線を描画します
   6. ![image](https://gist.github.com/user-attachments/assets/007c936d-cca4-4d04-9293-775156d4ec31) 矩形（塗りつぶし）<br>
      ドラッグした始点と終点を矩形の左上と右下とし、選択した色で塗りつぶします
   7. ![image](https://gist.github.com/user-attachments/assets/5b2a8d99-49cc-4318-a58d-981db359cb33) 楕円（枠線）<br>
      ドラッグした始点と終点を楕円の左上と右下とし、選択した色で枠線を描画します
   8. ![image](https://gist.github.com/user-attachments/assets/9894931d-58fd-45bc-8204-9f29dbf6fd93) 楕円（塗りつぶし）<br>
      ドラッグした始点と終点を楕円の左上と右下とし、選択した色で塗りつぶします
6. カラーパレット<br>
   描画ツールで編集する際の色を選択します。<br>
   パレットの色については一旦この32色としていますが、このカラーパレットでゲームの印象がだいぶ変わるため、今後別の色セットに変更する可能性もあります。（現状は PICO-8 の作者が開発中の Picotron のカラーパレットをそのまま採用しています）
7. 画面配置が未決定な機能を一時的に配置<br>
   UI 設計上ではまだ検討中ですが、機能としては実装したものを一時的にウィンドウ右端に集めています。今後の開発でそれぞれ適切な場所に移動予定です。
   1. ![image](https://gist.github.com/user-attachments/assets/9e0d5a8d-1d91-4731-8fe7-423c7be29ddd) ブラシサイズ選択<br>
      ブラシツールのブラシサイズを変更します。
   2. ![image](https://gist.github.com/user-attachments/assets/a7966f04-b9b6-44dc-b7e9-312279a0ef82) 物理演算の形状設定<br>
      スプライトは内部で形状を持ち、物理エンジンによる衝突判定に利用されます。<br>
      None、Rect、Circle がそれぞれ `物理演算なしスプライト`、`矩形形状スプライト`、`丸形状スプライト` となります。
   3. ![image](https://gist.github.com/user-attachments/assets/35b359f8-f4c5-4645-ab25-3d8732d81736) 物理演算の衝突の有無の設定<br>
      `Sensor` を選択すると、他スプライトと接触判定はするものの形状として衝突はしない（すり抜ける）ようにすることができます

#### 3.1.2 実装状況

レトロゲームのドット絵制作に必要となる基本的な機能はひととおり実装できました。

→ [現時点でのスプライトエディターのソースコード](https://github.com/xord/reight/blob/3e5ecac38bed9ee998a9f830527b1902405d101f/lib/reight/app/sprite/editor.rb)

#### 3.1.3 今後の予定

スプライトエディターとして当初予定していた基本機能は一旦実装できています。ただ、実際にゲーム開発で利用していくと欲しくなる機能がありますので、今後も継続して機能追加していく予定です。

##### 今後実装したい機能

- 左右、上下反転機能
- 曲線描画ツール
- 矩形以外の選択ツール
- レイヤー機能
- アニメーション関連機能

### 3.2 マップエディター

スプライトエディターで作成したドット絵をマップチップとして画面に配置し、RPG のフィールドやダンジョン等のマップを作成したり、横視点のプラットフォーマーゲーム向けのステージを作成する画面としてマップエディターも開発しました。

#### 3.2.1 機能説明

ここでは、マップエディターの画面を機能ごとに説明します。

![image](https://gist.github.com/user-attachments/assets/cf3ad635-22ee-4421-9ec0-3649f0e4c802)


1. ![image](https://gist.github.com/user-attachments/assets/1be09135-0e0a-48ba-aa0e-5f830cfb66a7) スプライトページ選択<br>
   3 の「スプライト選択領域」を16ページ分保持していますので、数字横の左右ボタンで表示するページを切り替えることができます。
2. ![image](https://gist.github.com/user-attachments/assets/70784aba-4bd5-47d2-a298-0f5440e3139a) スプライトのサイズ選択<br>
   8、16、32 はそれぞれドットで 8x8、16x16、32x32 を表し、配置するマップチップの大きさを変更します。
3. スプライト選択領域<br>
   8x8 や 16x16 などの大きさのスプライト画像を敷き詰めたスプライトシートを表示します。<br>
   クリックで選択した部分の画像を、6 の描画ツールで 5 のマップ編集領域に配置できるようにします。
4. ![image](https://gist.github.com/user-attachments/assets/1be09135-0e0a-48ba-aa0e-5f830cfb66a7) マップ選択<br>
   マップデータは複数作成することができるので、数字横の左右ボタンで表示するマップを切り替えることができます。
5. マップ編集領域<br>
   3 のスプライト選択領域で選択したマップチップを、6 の描画ツールで配置してマップを編集することができます。
6. 描画ツール
   1. ![image](https://gist.github.com/user-attachments/assets/b05f1179-37c8-4591-ab15-e16c85a3e207) ブラシ<br>
      マップ編集領域のクリックした位置に、選択したマップチップを配置します
   2. ![image](https://gist.github.com/user-attachments/assets/6bce9477-7d9c-440f-b2d3-a90974d4d387) 直線ツール<br>
      マップ編集領域のドラッグした始点と終点に、選択したマップチップを直線状に配置します
   3. ![image](https://gist.github.com/user-attachments/assets/8ca9796b-ca0f-46d8-9e0e-e5db153c186d) 矩形（枠線）<br>
      マップ編集領域のドラッグした始点と終点を矩形の左上と右下とし、選択したマップチップを枠線状に配置します
   4. ![image](https://gist.github.com/user-attachments/assets/007c936d-cca4-4d04-9293-775156d4ec31) 矩形（塗りつぶし）<br>
      マップ編集領域のドラッグした始点と終点を矩形の左上と右下とし、選択したマップチップを敷き詰めるように配置します

#### 3.2.2 実装状況

2Dレトロゲームのマップ・ステージ制作に必要な最低限の機能をひととおり実装できました。

→ [現時点でのマップエディターのソースコード](https://github.com/xord/reight/blob/3e5ecac38bed9ee998a9f830527b1902405d101f/lib/reight/app/map/editor.rb)

#### 3.2.3 今後の予定

マップエディターは、ゲーム制作に必要な最低限の機能を実装しました。開発スケジュール的に優先度をさげた機能もいくつかありますので、今後も継続して機能追加していきたいと思っています。

##### 今後実装したい機能

- 選択ツール
- 拡大縮小機能
- レイヤー機能
- 不動スプライト統合機能（負荷軽減のため）

### 3.3 統合環境化

スプライトエディターとマップエディターを実装した時点では起動時はどちらかの画面を固定で表示し切り替えられない状態でした。しかしレトロゲーム開発の統合開発環境とするために各エディターを切り替えながら利用できるする必要があります。

こちらは統合環境化実装中に、実際にスプライトエディターとマップエディターを切り替えて使う様子です。<br>
→ https://x.com/tokujiros/status/1863607102314631666

#### 3.3.1 機能説明

画面上部にナビゲーション用のバーを作り、そこに画面切り替えボタンを配置しました。

![image](https://gist.github.com/user-attachments/assets/601e618d-026f-4c05-abb6-ee7e7df04ab7)

1. エディター切り替えボタン
   1. ![image](https://gist.github.com/user-attachments/assets/371a3318-8131-4bde-8e3e-675d0b41a262) ゲーム実行画面<br>
      ソースコードやドット絵、マップデータなどを利用してゲームの実行を開始します。
   2. ![image](https://gist.github.com/user-attachments/assets/9a18a89f-22dc-4478-a210-8c08479f1c6a) スプライトエディター画面<br>
      スプライトエディター画面に切り替えます。
   3. ![image](https://gist.github.com/user-attachments/assets/ecf99575-d30b-4b33-bd57-df71ddf80c48) マップエディター画面<br>
      マップエディター画面に切り替えます。
   4. ![image](https://gist.github.com/user-attachments/assets/a5ee0fcb-c7d3-42ae-84af-ac35ab558635) サウンドエディター画面<br>
      サウンドエディター画面に切り替えます。

#### 3.3.2 実装状況

各画面切り替え用のツールバーを Navigator クラスとして実装しました。

→ [画面切り替え部のソースコード](https://github.com/xord/reight/blob/3e5ecac38bed9ee998a9f830527b1902405d101f/lib/reight/app/navigator.rb)

### 3.4 ゲーム実行機能の開発

ゲームエンジンを統合開発環境として設計するにあたり、ゲーム実行ボタンを押すたびにソースコードを初期状態から実行できる仕組みが必要です。このため、ゲームの実行開始時には実行環境を初期化し、前回の実行状態を引き継がないよう設計しました。具体的には、無名モジュールのインスタンスを実行コンテキストとして利用し、その中でソースコードを eval することで、各実行ごとの状態を完全に分離しています。

<img src="https://gist.github.com/user-attachments/assets/1fc538ca-18ca-490b-b814-7a6845c6be49" width="600">

#### 3.4.1 実装状況

ゲーム実行のための画面表示や実行環境の管理機能などを、Runner クラスとして実装しました。

→ [ゲーム実行機能のソースコード](https://github.com/xord/reight/blob/3e5ecac38bed9ee998a9f830527b1902405d101f/lib/reight/app/runner.rb)

#### 3.4.2 今後の予定

ソースコードは外部テキストエディターで編集することを想定していますので、ファイルが更新されたら自動で再実行、または実行状態のままコードを反映する仕組みを導入したいと思っています。これが実現できると、ゲーム開発の効率が大幅に向上するのでぜひ実現したいところです。

またゲーム実行コンテキスト分離の実装は無名モジュールを実行コンテキストとしたことの弊害で当初ユーザー定義クラス内でユーザー定義関数が呼べなかったりといくつか問題がありました。これを解決するために method_missing を活用するなど苦しい工夫で回避していますが、ここは今後 Ruby 本体に Namespace 機能が導入されれば、実行コンテキストをネームスペースで分離できるようになるのではないかと考えており、それが可能ならばシンプルに実装し直すことができるかもしれないと期待しています。

### 3.5 オーディオ機能実装に足りてない機能を低レイヤーに実装

前年度に採択いただき開発した Processing Gem でひととおりの機能が揃っているグラフィックス周りとは違い、サウンドエディターとミュージックエディターの開発には事前に低レイヤーの機能追加が必要でした。

低レイヤーに実装しているオーディオ関連の機能は、サイン波や矩形波、または任意の .wav ファイルなどを鳴らすまでしかできておらず、複数の音を組み合わせて新しく効果音を作成したり、音楽を鳴らしたりする機能が足りていませんでした。

このため低レイヤー部分にシーケンサークラスを追加実装しました。

#### 3.5.1 機能説明

Sequencer クラスのインターフェイスはシンプルです。以下のように利用します。

```
seq = Sequencer.new                      # シーケンサーオブジェクト作成
seq.add(Oscillator.new(freq: 440), 0, 1) # 再生開始から0秒目にラの音を1秒再生
seq.add(Oscillator.new(freq: 440), 2, 0.5) # 再生開始から2秒目にラの音を0.5秒再生
seq.add(Oscillator.new(freq: 440), 4, 0.1) # 再生開始から4秒目にラの音を0.1秒再生
Sound.new(seq, 5.1).play                   # シーケンサーオブジェクト自体を再生
```

シーケンサークラスに音と時間を指定して複数追加することで、指定時間通りに音を順に鳴らすことができるようになりました。

こちらは Sequencer クラスの動作確認のため、[簡易的な MML コンパイラー](https://gist.github.com/xord/6d0400193cdafe0600f1765880414729)を実装し短い音楽を鳴らしている様子です。<br>
 → https://x.com/tokujiros/status/1871253335141130653

#### 3.5.2 実装状況

C++ の低レイヤーライブラリに Sequencer クラスを実装しました。

→ [Sequencer クラスのソースコード](https://github.com/xord/beeps/blob/41b250fe2cee91a376109a98ac3a60b197196e8b/src/sequencer.cpp)

### 3.6 サウンドエディター

レトロゲームに適したサウンドを制作するために、シンプルな音を組み合わせて効果音を作ることができるサウンドエディターも開発しました。

#### 3.6.1 機能説明

ここではサウンドエディターの画面を機能ごとに説明します。

![image](https://gist.github.com/user-attachments/assets/1cbd4617-c0e7-468a-bc94-2a5b43da74f7)

1. ![image](https://gist.github.com/user-attachments/assets/c8fafe25-2c16-4b6d-9322-36aef1d50cc0) サウンド選択<br>
   サウンドデータは複数作成することができるので、数字横の左右ボタンで表示するサウンドを切り替えることができます。
2. ![image](https://gist.github.com/user-attachments/assets/dbdcc79a-8b85-4b44-ab0e-5574a6b4adad) BPM 設定<br>
   BPM (Beat Per Minute) とは1分間に刻まれる拍子の数を表す数字です。サウンドの再生スピードを設定することができます。
3. ![image](https://gist.github.com/user-attachments/assets/8926e08b-7004-4267-a1e4-dfb225af9466) データ編集<br>
   表示中のサウンドデータの中身を空にしたり、データ自体を削除することができます。
4. サウンド編集領域<br>
   横軸を時間、縦軸を音階として各波形の音符をブラシツール等で編集し、サウンドを制作することができます。
5. ![image](https://gist.github.com/user-attachments/assets/6565a949-8161-43e9-aa22-1d43bb26df67) 再生コントロール<br>
   編集中のサウンドを再生したり停止したすることができます。
6. 編集ツール
   1. ![image](https://gist.github.com/user-attachments/assets/4383188d-7b8b-4db9-801d-710e701bea07) ブラシ<br>
      4 のサウンド編集領域に、6 の波形選択で選んだ波形の音符を追加します。
   2. ![image](https://gist.github.com/user-attachments/assets/d6bb775a-d94e-4b55-8889-cf1675d9f8c6) 消しゴム<br>
      4 のサウンド編集領域の音符をクリックすることで削除することができます。
6. 波形選択<br>
   ブラシツールで追加する音の音色を選択することができます。
   1. ![image](https://gist.github.com/user-attachments/assets/69e41857-08cb-47d7-b76f-af0fe245b89a) サイン波<br>
      滑らかで柔らかい音。電子オルガンやフルートに似た音。
   2. ![image](https://gist.github.com/user-attachments/assets/18ceec4a-eaad-4d00-a8c8-e8b938e4b8e4) 三角波<br>
      サイン波より少し硬いが、優しく柔らかい音。オルガンやリコーダーのような音。
   3. ![image](https://gist.github.com/user-attachments/assets/5cd63795-3570-4c7c-8a3e-4760ccf7f940) 矩形波<br>
      ビープ音やレトロゲームの音に近い、くっきりした電子音。
   4. ![image](https://gist.github.com/user-attachments/assets/08a9a1dc-4e3b-489d-9676-84dcadd021f7) ノコギリ波<br>
      鋭く力強い音。バイオリンやシンセリードのような音。
   5. ![image](https://gist.github.com/user-attachments/assets/d33b98cf-e41d-4829-ab08-eb420e940ee7) パルス波（12.5%）<br>
      細く尖った音。鋭いビープ音のような印象。
   6. ![image](https://gist.github.com/user-attachments/assets/2ec0baea-96eb-47de-903b-583578359811) パルス波（15%）<br>
      12.5%よりも柔らかいが、それでも細く尖った感じ。
   7. ![image](https://gist.github.com/user-attachments/assets/7f0defa8-f4cb-4b5e-8097-0ec83a78bbc1) ノイズ
      砂嵐、風、爆発音、波の音のようなノイズ系の音。

#### 3.6.2 実装状況

レトロゲームのピコピコサウンドを手軽に制作することができるレベルまで実装することができました。

→ [現時点でのサウンドエディターのソースコード](https://github.com/xord/reight/blob/3e5ecac38bed9ee998a9f830527b1902405d101f/lib/reight/app/sound/editor.rb)

こちらはサウンドエディターで効果音を編集しゲーム内で鳴らす様子です。<br>
→ https://x.com/tokujiros/status/1887935444580712721

#### 3.6.3 今後の予定

サウンドエディターで効果音を作成するときに欲しい機能はまだありますので、今後も継続して機能追加していく予定です。

##### 今後実装したい機能

- 各音の音量の調整
- 音色の加工機能（エンベロープ、各種フィルター、LFO など）
- 選択と編集機能の強化

### 3.7 ミュージックエディター

当初はミュージックエディターも作成する予定でしたが、サウンドエディターで再生スピードを下げると音楽を作成することができることから、ほぼ同じ UI を別画面で用意する必要があるのか疑問があるため、一旦ミュージックエディターは実装しないこととしました。

音楽制作画面のつくりとしてはいろいろあり、ピアノロールをベースとしたマウス入力中心の方式、トラッカーと呼ばれる時間軸を縦に音の情報を数値で入力する方式、MML (Music Macro Language) ベースのテキスト入力方式など、レトロゲームのチップチューンを制作するのに適したインターフェイスを検討し今後改めて実装したいと思います。

## 4. その他の成果

ここからはメインのゲームエンジン開発以外の成果について記載します。

### 4.1 サンプルゲーム

このゲームエンジンでどんなゲームが作れるかを確認するため、よくあるタイプのゲームの基本部分をサンプルゲームとしていくつか制作しました。

#### 4.1.1 横視点アクション （プラットフォーマー）

いわゆるマリオブラザーズのような横視点で重力が下方向に向いたアクションゲームです。
1つ目のロボットがプレイヤーキャラクターで左右カーソルで移動、スペースキーでジャンプ。
トゲトゲにふれるとゲームオーバです。

[ソースコード](https://github.com/xord/reight-examples/blob/84e4542f070ae3b03df81920e6cf30eada843153/hello/game.rb)は空行とコメントを除くと 82行です。

![image](https://gist.github.com/user-attachments/assets/51b14872-242a-45e7-b534-473bd57cfb20)

#### 4.1.2 縦方向シューティング

一般的な縦シューティングゲームです。
進行方向は縦で、上から敵が来るのでカーソルキーで自機の移動とスペースキーでショットを撃ちます。

[ソースコード](https://github.com/xord/reight-examples/blob/84e4542f070ae3b03df81920e6cf30eada843153/shmup/game.rb)は空行とコメントを除くと 126行です。

![image](https://gist.github.com/user-attachments/assets/9154374f-1091-49ee-868a-f7c40c2a212a)

実際にゲームが動いている様子
→ https://x.com/tokujiros/status/1888308304222503386

#### 4.1.3 全方位シューティング

左右カーソルキーで自機を回転、上カーソルキーで加速、スペースキーで弾を撃ちます。

[ソースコード](https://github.com/xord/reight-examples/blob/84e4542f070ae3b03df81920e6cf30eada843153/shooter360/game.rb)は空行とコメントを除くと 106行です。

![image](https://gist.github.com/user-attachments/assets/ca11554f-b2d6-4019-afd6-55ce1e1a1506)

実際にゲームが動いている様子
→ https://x.com/tokujiros/status/1888524579687309398

#### 4.1.4 タワーディフェンス

ユーザーの操作は無く、設置した砲台が攻撃範囲に入った敵を自動的に攻撃します。
敵は画面右端から侵入・進行し、砲台の攻撃を耐え左端まで到達されるとゲームオーバーです。
この状態ではゲーム性がゼロですが、敵を倒したらコインをゲットしそのコインで砲台を強化するなどが考えられます。

[ソースコード](https://github.com/xord/reight-examples/blob/84e4542f070ae3b03df81920e6cf30eada843153/towerdefence/game.rb)は空行とコメントを除くと 121行です。

![image](https://gist.github.com/user-attachments/assets/4648dfb7-5e6b-4cf5-97bf-b5be016e592d)

実際にゲームが動いている様子
→ https://x.com/tokujiros/status/1889025712948158569

#### 4.1.5 トップビュー視点のレースゲーム

上下左右カーソルキーを押した方向にプレイヤーの向きが変わり、カーソルを押している間はプレイヤーのレースシップがジェット推進で直進します。
レースシップには慣性が働くため、減速する際には逆向きにジェットを噴射する必要があります。
スタート地点からゴールまでのタイムを競います。（作者のベストタイムは 8.183秒です）

[ソースコード](https://github.com/xord/reight-examples/blob/84e4542f070ae3b03df81920e6cf30eada843153/jetrace/game.rb)は空行とコメントを除くと 126行です。

![image](https://gist.github.com/user-attachments/assets/1f6f08ab-cfc6-47ec-989f-22fb2463559a)

実際にゲームが動いている様子
→ https://x.com/tokujiros/status/1895666246785610226

#### 4.1.6 サバイバー系ゲーム

ヴァンパイアサバイバーズという人気ゲーム風のサンプルゲームです。
カーソルキーでプレイヤーキャラクターを移動しますが、攻撃は自動で弾を撃つだけなのでプレイヤーは敵を避けることに集中します。

[ソースコード](https://github.com/xord/reight-examples/blob/84e4542f070ae3b03df81920e6cf30eada843153/survivor/game.rb)は空行とコメントを除くと 159行です。

![image](https://gist.github.com/user-attachments/assets/c3b22f41-5067-44b5-b810-5e70ccae7fa5)

実際にゲームが動いている様子
→ https://x.com/tokujiros/status/1895781930924462379

#### 4.1.6 地下掘りゲーム

地面を掘って、鉱石をゲットしてスコアを稼ぐゲームです。
左右カーソルキーでプレイヤーキャラクターが移動し、スペースキーでジャンプします。
キャラクターが地面に接した方向のカーソルキーを押すと地面を掘り、金塊ブロックは三回掘ることで金をゲットすることができます。

[ソースコード](https://github.com/xord/reight-examples/blob/8af3a2494920f2b06fe9ae948ac3a319936d6641/miner/game.rb)は空行とコメントを除くと 106行です。

![image](https://gist.github.com/user-attachments/assets/e398a988-fad7-473f-b3e9-c7f6ff181402)

実際にゲームが動いている様子
→ https://x.com/tokujiros/status/1898807976049390028

### 4.2 発表

1/18 の「東京Ruby会議12」でゲームエンジンについて発表しました。

- [発表資料](https://speakerdeck.com/tokujiros/zerokarano-retorogemuenzinnozuo-rifang)

発表時には、運営中の Ruby でのゲーム開発 Discord への招待リンクを設置し 13名ほど参加いただくことができました。

### 4.3 動画配信

YouTube でサンプルゲーム開発の様子をライブ配信しました。

- [自作レトロゲームエンジンでタワーディフェンス風ゲームを作るよ](https://www.youtube.com/watch?v=LVh06ZktSC8)
- [2時間くらいでサクッと、サバイバー系ゲームを作るよ](https://www.youtube.com/watch?v=nQw0x4_M77w)
- [2時間くらいでサクッと、サバイバー系ゲームを作るよ 2](https://www.youtube.com/watch?v=J9TIcs06sgU)
- [【2D ゲーム開発】地面掘る系ゲームを作るよ](https://www.youtube.com/watch?v=6E1-4CmsUfg)

残念ながらほとんど視聴されていませんが、今後本レトロゲームエンジンでのゲーム制作 Howto 動画を制作・配信し、Ruby によるゲーム開発の敷居を下げられるようにしていきたいと思っています。

## 5. 課題と今後の展望

### 5.1 ドキュメント整備

ゲームエンジン自体は実用できるレベルになってきましたが、肝心のドキュメント類がまだ足りていません。ですので今後はリファレンスやチュートリアルなども作成し発信していく計画です。

### 5.2 WebAssembly 対応

ruby.wasm 対応をすることで、ゲームエンジンで作ったゲームの実行環境としてブラウザーに対応することができます。これは作ったゲームを広く手軽に遊んでもらうためにはとても大きな利点になります。特に、インストール不要でブラウザー上で即座に動作することは、ユーザーの障壁を大きく下げるため、カジュアルなプレイヤーにもリーチしやすくなります。

## 6. まとめ

当初計画していた開発内容はほぼ予定通り実装することができました。これによって、目的としていた通り Ruby で手軽にゲーム開発を始められるツールが制作できました。

これからはソフトウェアとしての機能強化や環境整備を継続するとともに、利用者を増やし、Ruby によるゲーム制作人口を増やすことによって Web 開発以外の用途での Ruby 利用率を増やすことにもつなげていきたいと思います。

## 7. さいごに

この成果を達成するためにサポートしてくださった Ruby アソシエーション様と、メンターとして支えてくださった須藤功平様に深く感謝いたします。
